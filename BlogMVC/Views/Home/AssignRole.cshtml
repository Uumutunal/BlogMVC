@{
    ViewBag.Title = "AssignRole";
    Layout = "~/Views/Template/Index.cshtml";
    var users = ViewBag.Users as List<UserViewModel>;

}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    <link rel="stylesheet" href="~/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <div class="container mt-5">
            <h2>Select Options</h2>
            <form asp-action="AssignRole" method="post">
                <div class="form-group">
                    <label for="user">Users:</label>
                    <select id="user" name="user" class="form-control">
                        @foreach (var item in users)
                        {
                            <option value="@item.Email">@item.Email</option>
                        }
                        @foreach (var item in users)
                        {
                            <input type="hidden" id="userData-@item.Id" value="@item.Id">
                        }
                    </select>
                </div>

                <div class="form-group">
                    <label for="role">Roles:</label>
                    <select id="role" name="Role" class="form-control">
                        @foreach (var item in ViewBag.Roles)
                        {
                            <option value="@item">@item</option>
                        }
                    </select>
                </div>

                <button type="submit" class="btn btn-primary mt-3">Assign Role</button>
            </form>

            <!-- Form to remove a role from the selected user -->
            <form asp-action="RemoveRole" method="post" class="mt-3">
                <input type="hidden" id="removeUserId" name="userId" value="" />
                <input type="hidden" id="removeRoleId" name="roleId" value="" />

                <button type="button" class="btn btn-danger mt-3" onclick="removeRole()">Remove Role</button>
            </form>


            <!-- Div to display user roles -->
            <div id="userRoles" class="mt-5">
                <h4>User Roles</h4>
                <ul id="rolesList"></ul>
            </div>
        </div>

    </div>

    <script src="~/js/bootstrap.bundle.min.js"></script>
    <br />
    <br />
    <br />
</body>
</html>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#user').change(function () {
            var userId = $(this).val();
            console.log(userId)
            // Make an AJAX request to fetch user roles
            $.ajax({
                url: '@Url.Action("GetUserRoles", "Home")',
                type: 'GET',
                data: { id: userId },
                success: function (roles) {
                    // Clear existing roles
                    $('#rolesList').empty();

                    // Add roles to the list
                    roles.forEach(function (role) {
                        console.log(role)
                        $('#rolesList').append('<li>' + role + '</li>');
                    });
                },
                error: function (xhr, status, error) {
                    console.log("An error occurred while fetching the user roles.");
                }
            });
        });
    });

    function removeRole() {
        var userEmail = document.getElementById("user").value;
        var roleName = document.getElementById("role").value;

        // Assuming you have hidden inputs to store user and role ID
        //var userId = document.querySelector(`#userData-${userEmail}`).value;

        document.getElementById("removeUserId").value = "userId";
        document.getElementById("removeRoleId").value = roleName;

        // Submit the form
        document.querySelector("form[asp-action='RemoveRole']").submit();
    }
</script>
